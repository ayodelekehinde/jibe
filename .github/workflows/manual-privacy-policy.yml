name: Publish Privacy Policy to GitHub Pages

on:
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Prepare Site
        run: |
          mkdir -p public/privacy-policy
          
          # 1. Create the Privacy Policy HTML directly (Static, no Jekyll needed)
          echo "<!DOCTYPE html><html><head><title>Jibe Privacy Policy</title>" > public/privacy-policy/index.html
          echo "<meta name='viewport' content='width=device-width, initial-scale=1'><style>body{font-family:system-ui,-apple-system,sans-serif;max-width:800px;margin:0 auto;padding:20px;line-height:1.6}h1{border-bottom:1px solid #eaeaea;padding-bottom:10px}</style>" >> public/privacy-policy/index.html
          echo "</head><body>" >> public/privacy-policy/index.html
          
          # Convert pseudo-markdown to HTML (simple replacement for headers)
          # Note: generic sed replacement for # headers to h1/h2 is fragile but sufficient for this specific simple file
          sed 's/^# \(.*\)/<h1>\1<\/h1>/' PRIVACY_POLICY.md | sed 's/^## \(.*\)/<h2>\1<\/h2>/' >> public/privacy-policy/index.html
          
          echo "</body></html>" >> public/privacy-policy/index.html
          
          # 2. Create Root Redirect
          echo '<!DOCTYPE html><html><head><meta http-equiv="refresh" content="0; url=./privacy-policy/" /></head><body>Redirecting...</body></html>' > public/index.html
          
          # 3. Disable Jekyll to ensure files are served exactly as is
          touch public/.nojekyll

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'public'

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
